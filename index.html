<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Permutation Test: Visual Explanation</title>
	<meta name="description" content="Scrollama Demo: Fixed CSS">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src='https://cdnjs.cloudflare.com/ajax/libs/d3/4.13.0/d3.min.js'></script>
	<link rel="stylesheet" href="permutationTest.css">
	<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=default'></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/rough.js/2.2.5/rough.min.js"></script>
	<script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
	<!-- <script src=assets/d3v4.js></script> -->
	<stylesheet href="https://fonts.googleapis.com/css?family=Indie+Flower" rel="stylesheet">
	<style>
    @import 'https://fonts.googleapis.com/css?family=Indie+Flower';

	</style>
 


</head>

<body>
	<section id='intro'>
		<p class='intro__overline'>
			May 2018 By <a href='https://twitter.com/jdwlbr'>Jared Wilber</a>
		</p>
		<h1 class='intro__hed'>The Permutation Test</h1>
		<p class='intro__dek'>
			A Visual Explanation of Statistical Testing
		</p>
		<p class='intro__bod'>
			The permutation test is a nonparametric statistical test. 
			Statistical tests, also known as hypothesis tests, are used in the design of experiments, and are used to measure the <i>effect(s)</i> of some <i>treatment(s)</i> on <i>experimental units</i>. For example, we may wish to determine whether or not drug A is better than drug B at curing some disease, or whether facebook using <span class="fb_highlight_one">#3b5998</span> instead of <span class="fb_highlight_two">#8b9dc3</span> for it's LIKE button results in a higher number of clicks. 
			<br><br>
			We determine the results of such experiments via a summary statistic known as a <a href="">p-value</a>. 
			For many statistical tests, the calculation of the p-value is complicated and unintuituve. 
			To calculate the p-value for a permutation test, we employ the following:
		</p>

	</section>
	<section id='scroll'>
		<div class='scroll__graphic'>
			<div class='chart'>
				<!-- <svg style="width:100%;height:100%;"> -->
				<svg id='svg' style="width:100%;height:100%;"></svg>

			</div>
		</div>
		<div class='scroll__text'>
			<div class='step' data-step='1'>
				<h2 class="subheader">Now You're a Llama Herder</h2>
				<p>
 				You're a llama herder and would like to determine if a popular new llama diet increases the fleece quality of your llamas.<br><br>
 				In statistical testing, experiments are often structured in terms of a <a href="">null</a> and a <a href="">alternative</a> hypothesis.
 				We'll conduct our test with the following hypothesis schema<b>:</b>
				$$ {H_0: \mu_{treatment} = \mu_{control}} $$
				$$ {H_A: \mu_{treatment} \neq \mu_{control}} $$
				Our null hypothesis claims that the new llama diet has no effect<b>;</b> both the regular diet and the new diet yield the same fleece quality. The alternative claims the opposite; that diets yield differences in fleece quality.<br><br>
				We determine the experiment's results via a <a href="">p-value</a>. More on those soon.
				<p></p>

 				
 			</p>
			</div>
			<div class='step' data-step='2'>
				<h2 class='subheader'>Randomization</h2>
				<p>Before carrying out our experiment, we must randomly assign half of our llamas to the new diet. <br><br>
				We say that the llamas receiving the new diet belong to the <i>treatment</i> group. The others to the <i>control</i> group. The assignment of a llama to a given diet is known as its <i>treatment assignment</i>.
				<br><br>
				Randomization of treatment assignment is very important. It removes bias and conofunding from our results, and provides the basis for the theory underpinning out statistical test.
				</p>
			</div>
			<div class='step' data-step='3'>
				<h2 class='subheader'>Response Values</h2>
				<p>
				Every experimental unit receives a response value.
				 </p>
			</div>
			<div class='step' data-step='4'>
				<h2 class='subheader'>Test Statistic</h2>
				<p>
				Our <i>test statistic</i> is a numerical summary of our data that we'll use to  distinguish the null hypothesis from the alternative hypothesis. 
				<br><br>
				 Each llama has its own value for fleece quality, or "<i>response</i>" value. To detect any differences between the groups, we need a test statistic. Permutation tests allow us to use any value we want for our test statistic. 
				  We'll keep things simple and use the difference in mean response values between the two diets:
				$$ {T = \mu_{treatment} - \mu_{control}} $$
				<br>
				<!-- As you'll soon see, this value will be used to obtain our <i>p-value</i>. -->
				Once our llamas have gone through their assigned diets and we get our fleece quality response values, we calculate our initial test statistic and save it for later.
				 </p>
			</div>
			<div class='step' data-step='5'>
				<h2 class='subheader'>The 'P' in  'Permutation Test'</h2>
				<p>
					This is the most important step in the test, as well as its namesake.
					<br><br>
					While keeping the same response values we received earlier, we permute (shuffle) the treatment assignments of our llamas, and re-calculate our test statistic.
					<br><br>
					We do this because we analyze the results of our experiment relative to the null hypothesis, which posits both llama diets (the new and the original) as having identical effects on fleece quality. 
					<br><br>
					In other words, we think the new diet has no effect on the fleece quality of our llamas, so
					shuffling the diets of our llamas and recalculating our test statistic (without re-running our experiment) won't matter - we'll obtain similar fleece quality values for both groups.
					<br>
				</p>
			</div>
			<div class='step' data-step='6'>
				<h2 class='subheader'>Create Test Statistic Distribution</h2>
				<p>
					Ideally, we'd recalculate our test statistics across all diet assignment permutations among our llamas, creating a distribution of <i>all</i> possible test statistic values.
					<br><br>
					Unfortunatley, this number is often <a href="https://en.wikipedia.org/wiki/Factorial">far too large</a> for practicality, so instead we resample <a href="">enough</a> permutations to build an approximation to our distribution. 
					<br><br>
					This distribution approximates all possible mean-difference values we could have seen under the assumption that fleece quality is independent of llama diet. 
					<br><br>By observing where our initial test statistic falls within this distribution, we obtain the final piece for our test. <br>The <i>p-value</i>.
				</p>
			</div>
			<div class='step' data-step='7'>
				<h2 class='subheader'>Create Test Statistic Distribution</h2>
				<p>
					Ideally, we'd recalculate our test statistics across all diet assignment permutations among our llamas, creating a distribution of <i>all</i> possible test statistic values.
					<br><br>
					Unfortunatley, this number is often <a href="https://en.wikipedia.org/wiki/Factorial">far too large</a> for practicality, so instead we resample <a href="">enough</a> permutations to build an approximation to our distribution. 
					<br><br>
					This distribution approximates all possible mean-difference values we could have seen under the assumption that fleece quality is independent of llama diet. 
					<br><br>By observing where our initial test statistic falls within this distribution, we obtain the final piece for our test. <br>The <i>p-value</i>.
				</p>
			</div>
			<div class='step' data-step='8'>
				<h2 class='subheader'>Create Test Statistic Distribution</h2>
				<p>
					Ideally, we'd recalculate our test statistics across all diet assignment permutations among our llamas, creating a distribution of <i>all</i> possible test statistic values.
					<br><br>
					Unfortunatley, this number is often <a href="https://en.wikipedia.org/wiki/Factorial">far too large</a> for practicality, so instead we resample <a href="">enough</a> permutations to build an approximation to our distribution. 
					<br><br>
					This distribution approximates all possible mean-difference values we could have seen under the assumption that fleece quality is independent of llama diet. 
					<br><br>By observing where our initial test statistic falls within this distribution, we obtain the final piece for our test. <br>The <i>p-value</i>.
				</p>
			</div>
			<div class='step' data-step='9'>
				<h2 class='subheader'>Results: The P-Value</h2>
				<p> The p-value is the probability of observing the response values we did, if the null hypothesis was true.
					<br><br>
					For some statistical tests, calculating the p-value can get quite complicated. For permutation tests, it's simple. We simply count the number of values as or more extreme than our initial test statistic, and divide it by __.
					For some statistical tests, calculating the p-value can get quite complicated. For permutation tests, it's simple. We simply count the number of values as or more extreme than our initial test statistic, and divide it by __.
					For some statistical tests, calculating the p-value can get quite complicated. For permutation tests, it's simple. We simply count the number of values as or more extreme than our initial test statistic, and divide it by __.
					<br><br>
										For some statistical tests, calculating the p-value can get quite complicated. For permutation tests, it's simple. We simply count the number of values as or more extreme than our initial test statistic, and divide it by __.

				</p>
			</div>
			
		</div>
		<p class='intro__bod'>
			The permutation test is a nonparametric statistical test. 
			Statistical tests, also known as hypothesis tests, are used in the design of experiments, and are used to measure the <i>effect(s)</i> of some <i>treatment(s)</i> on <i>experimental units</i>. For example, we may wish to determine whether or not drug A is better than drug B at curing some disease, or whether facebook using <span class="fb_highlight_one">#3b5998</span> instead of <span class="fb_highlight_two">#8b9dc3</span> for it's LIKE button results in a higher number of clicks. 
			<br><br>
			We determine the results of such experiments via a summary statistic known as a <a href="">p-value</a>. 
			For many statistical tests, the calculation of the p-value is complicated and unintuituve. 
			To calculate the p-value for a permutation test, we employ the following:
		</p>
	</section>
	<section id='intro'>
		<p><br></p><p><br></p><p><br></p>
		<h2> Conclusion</h2>
		<p class='intro__bod'>
			The permutation test is a nonparametric statistical test. 
			Statistical tests, also known as hypothesis tests, are used in the design of experiments, and are used to measure the <i>effect(s)</i> of some <i>treatment(s)</i> on <i>experimental units</i>. For example, we may wish to determine whether or not drug A is better than drug B at curing some disease, or whether facebook using <span class="fb_highlight_one">#3b5998</span> instead of <span class="fb_highlight_two">#8b9dc3</span> for it's LIKE button results in a higher number of clicks. 
			<br><br>
			We determine the results of such experiments via a summary statistic known as a <a href="">p-value</a>. 
			For many statistical tests, the calculation of the p-value is complicated and unintuituve. 
			To calculate the p-value for a permutation test, we employ the following:
		</p>
	</section>
	<div class='debug'></div>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/scrollama/1.3.0/scrollama.js'></script>
	<!-- <script src=assets/scrollama.js></script> -->
	<script>
		var container = d3.select('#scroll');
		var graphic = container.select('.scroll__graphic');
		var chart = graphic.select('.chart');
		var text = container.select('.scroll__text');
		var step = text.selectAll('.step');

		var scroller = scrollama();

		// generic window resize listener event
		function handleResize() {
			// 1. update height of step elements
			var stepHeight = Math.floor(window.innerHeight * 0.9); // was * .75
			step.style('height', stepHeight + 'px');
			// 2. update width/height of graphic element
			var bodyWidth = d3.select('body').node().offsetWidth;
			graphic
				.style('width', bodyWidth + 'px')
				.style('height', window.innerHeight + 'px');
			var chartMargin = 32;
			var textWidth = text.node().offsetWidth;
			var chartWidth = graphic.node().offsetWidth - textWidth - chartMargin;
			chart
				.style('width', chartWidth + 'px')
				.style('height', Math.floor(window.innerHeight / 1.2) + 'px');
			// 3. tell scrollama to update new element dimensions
			scroller.resize();
		}

		// scrollama event handlers
		function handleStepEnter(response) {
			// add color to current step only
			step.classed('is-active', function (d, i) {
				return i === response.index;
			})

			// console.log('response index:' + response.index)

			if (response.index == 0 & response.direction == 'down') {
				console.log('0 down')
				transitionZeroDown()
			} else if (response.index == 0 & response.direction == 'up') {
				console.log('0 up')
				transitionZeroUp()
			}else if (response.index == 1 & response.direction == 'down') {
				console.log('1 down')
				transitionOneDown()
			} else if (response.index == 1 & response.direction == 'up') {
				console.log('1 up')
				transitionOneUp()
			} else if (response.index == 2 & response.direction == 'up') {
				console.log('2 up')
                transitionTwoUp()
           } else if (response.index == 2 & response.direction == 'down') {
           	    console.log('2 down')
                transitionTwoDown()
		   } else if (response.index == 3 & response.direction == 'up'){
			   	console.log('3 up')
			   	transitionThreeUp()
			   	moveNodes()
		   } else if (response.index == 3 & response.direction == 'down'){
		   		console.log('3 down')
		   		transitionThreeDown()
		   } else if (response.index == 4 & response.direction == 'up'){
			   	console.log('4 up')
			   	transitionFourUp()
		   } else if (response.index == 4 & response.direction == 'down'){
			   	console.log('4 down')
		   		transitionFourDown()
		   } else if (response.index == 5 & response.direction == 'up'){
			   	console.log('5 up')
			   	transitionFiveUp()
		   } else if (response.index == 5 & response.direction == 'down'){
			   	console.log('5 down')
			   	transitionFiveDown()
		   } else if (response.index == 6 & response.direction == 'up'){
			   	console.log('6 up')
		   } else if (response.index == 6 & response.direction == 'down'){
			   	console.log('6 down')
			   	transitionSixDown()
		   } else if (response.index == 7 & response.direction == 'up'){
			   	console.log('7 up')
		   } else if (response.index == 7 & response.direction == 'down'){
			   	console.log('7 down')
		   }
		 } 
		 // new 2down == 3down
		 // new threedown == fourdown
		 //new 4down == 2down
		 // make fourdown 2down

		function handleContainerEnter(response) {
			// response = { direction }
			// sticky the graphic (old school)
			graphic.classed('is-fixed', true);
			graphic.classed('is-bottom', false);
		}
		function handleContainerExit(response) {
			// response = { direction }
			// un-sticky the graphic, and pin to top/bottom of container
			graphic.classed('is-fixed', false);
			graphic.classed('is-bottom', response.direction === 'down');
		}

		function init() {
			// 1. force a resize on load to ensure proper dimensions are sent to scrollama
			handleResize();
			// 2. setup the scroller passing options
			// this will also initialize trigger observations
			// 3. bind scrollama event handlers (this can be chained like below)
			scroller.setup({
				container: '#scroll',
				graphic: '.scroll__graphic',
				text: '.scroll__text',
				step: '.scroll__text .step',
				debug: false,
			})
				.onStepEnter(handleStepEnter)
				.onContainerEnter(handleContainerEnter)
				.onContainerExit(handleContainerExit);
			// setup resize event
			window.addEventListener('resize', handleResize);
		}
		// kick things off
		init();
	</script>
	<hr>
	<script src="permTest.js"></script>
</body>

</html>
